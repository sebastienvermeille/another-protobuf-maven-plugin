<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/apt/examples/protoc-plugin.apt.vm at 2022-08-04

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Another Maven Protocol Buffers Plugin &#x2013; Using Custom Protoc Plugins</title>
    <link rel="stylesheet" href="../css/maven-base.css" />
    <link rel="stylesheet" href="../css/maven-theme.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">Another Maven Protocol Buffers Plugin
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2022-08-04</span>
          &#xA0;| <span id="projectVersion">Version: 0.7.2-SNAPSHOT</span>
      </div>
      <div class="xright"><a href="https://github.com/google/protobuf" class="externalLink" title="Google Protocol Buffers">Google Protocol Buffers</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Overview</h5>
    <ul>
     <li class="none"><a href="../index.html" title="Introduction">Introduction</a></li>
     <li class="none"><a href="../plugin-info.html" title="Goals">Goals</a></li>
     <li class="none"><a href="../usage.html" title="Usage">Usage</a></li>
     <li class="none"><a href="../faq.html" title="FAQ">FAQ</a></li>
    </ul>
       <h5>Examples</h5>
    <ul>
     <li class="none"><a href="../examples/protobuf-dependencies.html" title="Resolving Protobuf Dependencies">Resolving Protobuf Dependencies</a></li>
     <li class="none"><a href="../examples/protobuf-toolchain.html" title="Protobuf Toolchain">Protobuf Toolchain</a></li>
     <li class="none"><a href="../examples/protoc-artifact.html" title="Protoc Artifact">Protoc Artifact</a></li>
     <li class="none"><strong>Custom Protoc Plugins</strong></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="../project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="../project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section>
<h2><a name="Using_Custom_Protoc_Plugins"></a>Using Custom Protoc Plugins</h2>
<p>It is possible to customize <code>protoc</code>'s output with plugins. Protoc plugins are executables that are invoked by <code>protoc</code>. They read code generator requests from <code>stdin</code> and output results to <code>stdout</code>.</p>
<p>Currently, both native and pure Java plugins are supported.</p>
<p>Plugins written in Java (or any other JVM language) have to be resolvable as Maven artifacts. Also, the output directory for generated files is the same as the Java output directory. They are configured by adding a <code>protocPlugins</code> element containing one of more <code>protocPlugin</code> elements to the <code>configuration</code> section.</p>
<p>Native plugins are supported by two dedicated goals: <a href="../compile-custom-mojo.html">protobuf:compile-custom</a> and <a href="../test-compile-custom-mojo.html">protobuf:test-compile-custom</a>.</p><section>
<h3><a name="Using_a_pure_Java_protoc_plugin"></a>Using a pure Java <code>protoc</code> plugin</h3>
<p>The following example includes uses a single plugin to generate Java code in addition to <code>protoc</code>'s regular output.</p>
<div class="source">
<pre>
&lt;plugin&gt;
  &lt;groupId&gt;dev.cookiecode&lt;/groupId&gt;
  &lt;artifactId&gt;another-protobuf-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;0.7.2-SNAPSHOT&lt;/version&gt;
  &lt;extensions&gt;true&lt;/extensions&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;goals&gt;
          &lt;goal&gt;compile&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;protocPlugins&gt;
          &lt;protocPlugin&gt;
            &lt;id&gt;myproto&lt;/id&gt;
            &lt;groupId&gt;myproto&lt;/groupId&gt;
            &lt;artifactId&gt;myproto-protoc-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.2&lt;/version&gt;
            &lt;mainClass&gt;myproto.MyProtocPlugin&lt;/mainClass&gt;
          &lt;/protocPlugin&gt;
        &lt;/protocPlugins&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre></div>
<p>This will resolve the Maven artifact <code>myproto:myproto-protoc-plugin:1.2</code> and its dependencies, create a plugin executable on the fly and then invoke <code>protoc</code> with the argument <code>--myproto_out=JAVAOUT</code> where <code>JAVAOUT</code> is same directory used for the <code>--java_out</code> argument.</p></section><section>
<h3><a name="protocPlugin_Options"></a><code>protocPlugin</code> Options</h3>
<p>The following options can be included in the <code>protocPlugin</code> element:</p>
<ul>
<li><code>id</code> - (required) unique id for this plugin</li>
<li><code>groupId</code> - (required) group id for dependency resolution</li>
<li><code>artifactId</code> - (required) artifact id for dependency resolution</li>
<li><code>version</code> - (required) version specification for dependency resolution, can be either a single version (e.g. <code>1.2</code>) or a version range (e.g. <code>[1.2,1.3)</code>)</li>
<li><code>classifier</code> - (optional) artifact classifier for dependency resolution</li>
<li><code>mainClass</code> - (required) Java main class to execute</li>
<li><code>javaHome</code> - (optional) location of the JDK used for executing the plugin; uses the JDK specified in <code>toolchains.xml</code> or the value of the <code>java.home</code> system property as default</li>
<li><code>winJvmDataModel</code> - (optional; Windows only) data model of the JVM under <code>javaHome</code>. Possible values are '32' or '64'.</li>
<li><code>args</code> - (optional) argument to pass to the <code>main</code> method</li>
<li><code>jvmArgs</code> - (optional) JVM arguments</li></ul>
<p>The location of the <code>java</code> command (on UNIX) or <code>jvm.dll</code> on Windows is determined as follows. First, the <code>javaHome</code> option in <code>protocPlugin</code> is used, if present. Otherwise, the <code>jdkHome</code> location of the <code>jdk</code> toolchain in <code>toolchains.xml</code> is used. If no toolchain has been set up, the JDK that's running Maven is used (the value of the <code>java.home</code> system property).</p>
<p>When running on Windows the plugin will try to determine whether <code>javaHome</code> is pointing to a 32-bit or 64-bit JDK/JRE. If it cannot determine the data model from directories under <code>javaHome</code> it will use the value of the <code>sun.arch.data.model</code> system property in the JVM that is running the plugin code. If that system property does not exist it will default to 32-bit. The value can be overridden by setting the <code>winJvmDataModel</code> option.</p></section><section>
<h3><a name="Java_plugin_generation"></a>Java plugin generation</h3>
<p>A Java-based executable is assembled on the fly from the specified artifact and its dependencies and executed by <code>protoc</code>. The way this is done is platform-dependent.</p>
<p>On UNIX, a shell script is created in <code>target/protoc-plugins</code> that builds a classpath from local repository paths of all resolved artifacts and then runs the configured <code>java</code> command.</p>
<p>On Windows, a WinRun4J executable (bundled inside the Maven plugin jar) is copied into <code>target/protoc-plugins</code> and an <code>.ini</code> is generated with the required classpath, <code>jvm.dll</code> location, main class and arguments.</p>
<p>The <code>target/protoc-plugins</code> directory is prepended to the <code>PATH</code> in <code>protoc</code>'s runtime environment.</p></section><section>
<h3><a name="References"></a>References</h3>
<ul>
<li><a class="externalLink" href="https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.plugin.pb"> protoc plugin API</a></li></ul></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2021&#x2013;2022<a href="https://github.com/sebastienvermeille/another-protobuf-maven-plugin/blob/master/AUTHORS">Maven Protocol Buffers Plugin Authors</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
