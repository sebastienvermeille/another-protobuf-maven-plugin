<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/apt/examples/protobuf-dependencies.apt.vm at 2022-08-04

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Another Maven Protocol Buffers Plugin &#x2013; Resolving Protobuf Dependencies</title>
    <link rel="stylesheet" href="../css/maven-base.css" />
    <link rel="stylesheet" href="../css/maven-theme.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">Another Maven Protocol Buffers Plugin
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2022-08-04</span>
          &#xA0;| <span id="projectVersion">Version: 0.7.2-SNAPSHOT</span>
      </div>
      <div class="xright"><a href="https://github.com/google/protobuf" class="externalLink" title="Google Protocol Buffers">Google Protocol Buffers</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Overview</h5>
    <ul>
     <li class="none"><a href="../index.html" title="Introduction">Introduction</a></li>
     <li class="none"><a href="../plugin-info.html" title="Goals">Goals</a></li>
     <li class="none"><a href="../usage.html" title="Usage">Usage</a></li>
     <li class="none"><a href="../faq.html" title="FAQ">FAQ</a></li>
    </ul>
       <h5>Examples</h5>
    <ul>
     <li class="none"><strong>Resolving Protobuf Dependencies</strong></li>
     <li class="none"><a href="../examples/protobuf-toolchain.html" title="Protobuf Toolchain">Protobuf Toolchain</a></li>
     <li class="none"><a href="../examples/protoc-artifact.html" title="Protoc Artifact">Protoc Artifact</a></li>
     <li class="none"><a href="../examples/protoc-plugin.html" title="Custom Protoc Plugins">Custom Protoc Plugins</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="../project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="../project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section>
<h2><a name="Resolving_Protobuf_Dependencies"></a>Resolving Protobuf Dependencies</h2><section>
<h3><a name="Overview"></a>Overview</h3>
<p>The source <code>*.proto</code> files are automatically added to the list of project resources, so when the project is built, they included in the resulting jar artifact.</p>
<p>When building a dependent project, every dependency in the <code>compile</code> (or <code>test</code>) scope is also automatically scanned for <code>*.proto</code> resources, and they are included on the include path for protobuf compiler. This also works for multi-module Maven reactor projects.</p></section><section>
<h3><a name="Project_layout"></a>Project layout</h3>
<p>By convention, protobuf sources are expected to be inside <code>src/main/proto</code> directory (although this is configurable).</p>
<p>The main requirement is that if a protobuf package is declared in the proto file, it must match its subdirectory under <code>src/main/proto</code>. If there is no package declaration, the file must reside directly inside <code>src/main/proto</code> and not in any subdirectory thereof. Otherwise protobuf compiler will have major problems resolving imports.</p>
<p>So if a <code>test1.proto</code> file contains:</p>
<div class="source">
<pre>package it.project1;</pre></div>
<p>...then the proto file should reside in <code>src/main/proto/it/project1</code>. And another proto file (possibly in another Maven module or project) will then be able to import it:</p>
<div class="source">
<pre>import &quot;it/project1/test1.proto&quot;;</pre></div></section><section>
<h3><a name="Including_dependencies"></a>Including dependencies</h3>
<p>When building a dependent project, where protobuf definitions import other definitions that are packaged into dependencies, it is important to make sure that the compiled classes are also available on the classpath (for example, imported through the same jar dependency).</p>
<p>In a typical scenario, simply declaring a Maven dependency is enough, as long as it's been generated by <code>another-protobuf-maven-plugin</code> or follows the same packaging structure.</p>
<p>When generating Java code <code>com.google.protobuf:protobuf-java</code> dependency must always be included and must be of the same version as protobuf compiler. That dependency has some core protobuf definitions bundled too.</p>
<p>Sample configuration that demonstrates both the usage of dependencies and the usage of additional protobuf compiler plugins:</p>
<div class="source">
<pre>
&lt;project&gt;
  ...
  &lt;properties&gt;
    &lt;protobufVersion&gt;3.11.1&lt;/protobufVersion&gt;
    &lt;grpcVersion&gt;1.7.0&lt;/grpcVersion&gt;
  &lt;/properties&gt;
  ...
  &lt;build&gt;
    &lt;extensions&gt;
      &lt;extension&gt;
        &lt;groupId&gt;kr.motd.maven&lt;/groupId&gt;
        &lt;artifactId&gt;os-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.6.1&lt;/version&gt;
      &lt;/extension&gt;
    &lt;/extensions&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;dev.cookiecode&lt;/groupId&gt;
        &lt;artifactId&gt;another-protobuf-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;0.7.2-SNAPSHOT&lt;/version&gt;
        &lt;configuration&gt;
          &lt;!-- Common configuration, used by all goals --&gt;
          &lt;protocArtifact&gt;
            com.google.protobuf:protoc:${protobufVersion}:exe:${os.detected.classifier}
          &lt;/protocArtifact&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;protoc-java&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;compile&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;protoc-grpc&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;compile-custom&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;!-- Configuration for a specific goal --&gt;
              &lt;pluginId&gt;grpc&lt;/pluginId&gt;
              &lt;pluginArtifact&gt;
                io.grpc:protoc-gen-grpc-java:${grpcVersion}:exe:${os.detected.classifier}
              &lt;/pluginArtifact&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
  &lt;!-- Core protobuf dependency --&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
      &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt;
      &lt;version&gt;${protobufVersion}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- Another dependency that contains both protobuf definitions and compiled java sources --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.google.api.grpc&lt;/groupId&gt;
      &lt;artifactId&gt;proto-google-common-protos&lt;/artifactId&gt;
      &lt;version&gt;1.12.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- gRPC dependencies --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.grpc&lt;/groupId&gt;
      &lt;artifactId&gt;grpc-netty&lt;/artifactId&gt;
      &lt;version&gt;${grpcVersion}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.grpc&lt;/groupId&gt;
      &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt;
      &lt;version&gt;${grpcVersion}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.grpc&lt;/groupId&gt;
      &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt;
      &lt;version&gt;${grpcVersion}&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  ...
&lt;/project&gt;
</pre></div></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2021&#x2013;2022<a href="https://github.com/sebastienvermeille/another-protobuf-maven-plugin/blob/master/AUTHORS">Maven Protocol Buffers Plugin Authors</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
