<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/apt/usage.apt.vm at 2022-08-04

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Another Maven Protocol Buffers Plugin &#x2013; Usage</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">Another Maven Protocol Buffers Plugin
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2022-08-04</span>
          &#xA0;| <span id="projectVersion">Version: 0.7.2-SNAPSHOT</span>
      </div>
      <div class="xright"><a href="https://github.com/google/protobuf" class="externalLink" title="Google Protocol Buffers">Google Protocol Buffers</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Overview</h5>
    <ul>
     <li class="none"><a href="index.html" title="Introduction">Introduction</a></li>
     <li class="none"><a href="plugin-info.html" title="Goals">Goals</a></li>
     <li class="none"><strong>Usage</strong></li>
     <li class="none"><a href="faq.html" title="FAQ">FAQ</a></li>
    </ul>
       <h5>Examples</h5>
    <ul>
     <li class="none"><a href="examples/protobuf-dependencies.html" title="Resolving Protobuf Dependencies">Resolving Protobuf Dependencies</a></li>
     <li class="none"><a href="examples/protobuf-toolchain.html" title="Protobuf Toolchain">Protobuf Toolchain</a></li>
     <li class="none"><a href="examples/protoc-artifact.html" title="Protoc Artifact">Protoc Artifact</a></li>
     <li class="none"><a href="examples/protoc-plugin.html" title="Custom Protoc Plugins">Custom Protoc Plugins</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section>
<h2><a name="Usage"></a>Usage</h2>
<p>Another Maven Protocol Buffers Plugin generates Java, C++ or Python sources from <code>.proto</code> files using the <code>protoc</code> tool. The following examples describe the basic usage of the Plugin.</p><section>
<h3><a name="Compiling_Protobuf_Sources_into_Java"></a>Compiling Protobuf Sources into Java</h3>
<p>The following default directory structure of the project is assumed:</p>
<div class="source">
<pre>
./
+- pom.xml
+- src/
   +- main/
      +- proto/
         +- message.proto
   +- test/
      +- proto/
         +- test_message.proto
</pre></div>
<p>Protocol buffer definitions are looked up under <code>src/main/proto/</code> directory by default. Any subdirectories under <code>src/main/proto/</code> are treated as package structure for protobuf definition imports. Similarly, protobuf definitions for use in tests are looked up under <code>src/test/proto/</code> directory by default.</p>
<p>A minimal configuration to invoke this plugin would look like:</p>
<div class="source">
<pre>
&lt;project&gt;
  ...
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
          &lt;version&gt;3.8.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;source&gt;1.8&lt;/source&gt;
          &lt;target&gt;1.8&lt;/target&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;dev.cookiecode&lt;/groupId&gt;
        &lt;artifactId&gt;another-protobuf-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;0.7.2-SNAPSHOT&lt;/version&gt;
        &lt;configuration&gt;
          &lt;protocExecutable&gt;/usr/local/bin/protoc&lt;/protocExecutable&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;compile&lt;/goal&gt;
              &lt;goal&gt;test-compile&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
  &lt;/build&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
      &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt;
      &lt;version&gt;3.4.0&lt;/version&gt;
    &lt;/dependency&gt;
    ...
  &lt;/dependencies&gt;
  ...
&lt;/project&gt;
</pre></div>
<p>The following conditions need to be met:</p>
<ul>
<li>Java 1.8 or newer is required for running Maven</li>
<li>Java 1.8 or newer is required for compiling the generated sources</li>
<li>Either <code>protoc</code> executable has to be in the <code>PATH</code> or the <code>protocExecutable</code> parameter has to be set to the correct location. An alternative configuration involves toolchains (described in plugin examples).</li>
<li>Plugin executions need to be defined, because the plugin is not part of the default lifecycle. However, plugin goals have default bindings to appropriate phases, therefore there is typically no need to specify phase bindings in plugin configuration.<br />Note: <code><a href="./test-compile-mojo.html">test-compile</a></code> goal will only be needed if there are custom protocol buffer definitions being used in your tests.</li>
<li>An appropriate version of <code>com.google.protobuf:protobuf-java</code> dependency has to be declared, or made available through POM inheritance: this is needed for compiling the generated source code. Note: it is important to make sure that the version of protobuf compiler is compatible with the version of protobuf java library (ideally they should be of the same version), otherwise the generated code will fail to compile.</li></ul>
<p>As soon as everything is set up, execute the following goals to build the project:</p>
<div class="source">
<pre>
mvn clean install
</pre></div></section><section>
<h3><a name="Dealing_with_.22Command_line_is_too_long.22_errors"></a>Dealing with &quot;Command line is too long&quot; errors</h3>
<p>This plugin simply invokes <code>protoc</code> binary, passing all necessary arguments on the command line. In some configurations with a very large number of protobuf definitions this may be a problem, due to the limits on command line length in the host operating system. Starting with <code>protoc</code> version 3.5.0 this can be worked around by passing the following option:</p>
<div class="source">
<pre>
&lt;plugin&gt;
  &lt;groupId&gt;dev.cookiecode&lt;/groupId&gt;
  &lt;artifactId&gt;another-protobuf-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;0.7.2-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    ...
    &lt;useArgumentFile&gt;true&lt;/useArgumentFile&gt;
  &lt;/configuration&gt;
  ...
&lt;/plugin&gt;
</pre></div>
<p>Unfortunately, for versions of <code>protoc</code> below 3.5.0, the only available option is to split the compilation into smaller chunks by decomposing the project into modules.</p></section><section>
<h3><a name="Compiling_Protobuf_Sources_into_other_programming_languages"></a>Compiling Protobuf Sources into other programming languages</h3>
<p>The plugin configuration is similar to compiling into Java, with the following alterations:</p>
<ul>
<li>A different set of goals will need to be used (e.g. <a href="./compile-cpp-mojo.html">compile-cpp</a>);</li>
<li>A dependency on <code>com.google.protobuf:protobuf-java</code> artifact may not be required.</li></ul></section><section>
<h3><a name="Running_Plugin_Goals_On_Command_Line"></a>Running Plugin Goals On Command Line</h3>
<p>It is possible to run Another Maven Protocol Buffers Plugin goals from the command line, even if the plugin is not configured in the project:</p>
<div class="source">
<pre>
mvn protobuf:compile      -DprotocExecutable=&quot;C:/Java/protobuf-2.4.1/bin/protoc.exe&quot;
mvn protobuf:test-compile -DprotocExecutable=&quot;C:/Java/protobuf-2.4.1/bin/protoc.exe&quot;
</pre></div>
<p>If a <code>protobuf</code> toolchain is configured in the project, then the toolchains plugin needs to be executed first and there is no need to specify the <code>protocExecutable</code> parameter.</p>
<div class="source">
<pre>
mvn toolchains:toolchain protobuf:compile
mvn toolchains:toolchain protobuf:test-compile
</pre></div></section><section>
<h3><a name="Suppressing_Compilation_Of_Unchanged_Definitions"></a>Suppressing Compilation Of Unchanged Definitions</h3>
<p>Normally this plugin invokes <code>protoc</code> compilation on every execution, but this can be overridden by the following configuration option:</p>
<div class="source">
<pre>
&lt;plugin&gt;
  &lt;groupId&gt;dev.cookiecode&lt;/groupId&gt;
  &lt;artifactId&gt;another-protobuf-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;0.7.2-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    ...
    &lt;checkStaleness&gt;true&lt;/checkStaleness&gt;
  &lt;/configuration&gt;
  ...
&lt;/plugin&gt;
</pre></div>
<p>If the project is built on NFS, the following setting may also be needed:</p>
<div class="source">
<pre>
&lt;plugin&gt;
  &lt;groupId&gt;dev.cookiecode&lt;/groupId&gt;
  &lt;artifactId&gt;another-protobuf-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;0.7.2-SNAPSHOT&lt;/version&gt;
  &lt;configuration&gt;
    ...
    &lt;checkStaleness&gt;true&lt;/checkStaleness&gt;
    &lt;staleMillis&gt;10000&lt;/staleMillis&gt;
  &lt;/configuration&gt;
  ...
&lt;/plugin&gt;
</pre></div></section><section>
<h3><a name="Output_Of_Binary_File_Descriptor_Sets"></a>Output Of Binary File Descriptor Sets</h3>
<p>It is possible to output binary <code>FileDescriptorSet</code> files containing all the descriptor metadata for generated classes. Descriptor sets are written by passing the <code>--descriptor_set_out</code> and <code>--include_imports</code> arguments to <code>protoc</code>.</p>
<p>Generated descriptor sets can optionally be attached to the build as artifacts. The default type and extension for descriptor sets is <code>pb</code>, and the plugin extensions need to be enabled in order to support the correct resolution of those dependencies in downstream projects.</p>
<p>Please see documentation for the following goals: <a href="./compile-descriptor-set-mojo.html">compile-descriptor-set</a> and <a href="./test-compile-descriptor-set-mojo.html">test-compile-descriptor-set</a>.</p></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2021&#x2013;2022<a href="https://github.com/sebastienvermeille/another-protobuf-maven-plugin/blob/master/AUTHORS">Maven Protocol Buffers Plugin Authors</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
